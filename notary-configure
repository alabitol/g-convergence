#!/bin/bash
# Default locations for private key and self-signed certificate
KEYFILE="./convergence.key"
CERTFILE="./convergence.pem"

# Prompt user for private key name
echo "Insert desired private key name (defaults to ./convergence.key): "
read PROMPT
if [ -n "$PROMPT" ]; then
    KEYFILE=$PROMPT
fi

# If $KEYFILE already exists, ask if the user wishes to overwrite
if [ -e $KEYFILE ]; then
    echo "Warning: About to delete $KEYFILE. Do you wish to overwrite?"
    read -n 1 PREF
    if [ $PREF != "y" ]; then
       exit
    fi
fi

# Generate private key
/usr/bin/openssl genrsa -out $KEYFILE 1024
echo "

"
# Prompt user for certificate name
echo "Insert desired certificate name (defaults to ./convergence.pem): "
read PROMPT
if [ -n "$PROMPT" ]; then
    CERTFILE=$PROMPT
fi

# If the CERTFILE already exists, prompt user before overwriting
if [ -e $CERTFILE ]; then
    echo "Warning: About to delete $CERTFILE. Do you wish to overwrite?"
    read -n 1 PREF
    if [ $PREF != "y" ]; then
        rm ./mycert.csr
        exit
    fi
fi

# If intermediate file mycert.csr exists, prompt user before overwriting
if [ -e "./mycert.csr" ]; then
    echo "Warning: About to delete intermediate file mycert.csr. Do you wish to overwrite?"
    read -n 1 PREF
    if [ $PREF != "y" ]; then
       exit
    fi
fi

# Create certificate request file
/usr/bin/openssl req -new -key $KEYFILE -out ./mycert.csr

# Sign our certificate request to make a real certificate
/usr/bin/openssl x509 -req -days 365 -in mycert.csr -signkey $KEYFILE -out $CERTFILE
# Delete intermediate files
rm mycert.csr
